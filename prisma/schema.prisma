generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ENUMS

enum UserRole {
  ADMIN
  OWNER
}

enum PropertyStatus {
  AVAILABLE   // Bisa di-inquiry
  BOOKED      // Sudah ada booking
  INACTIVE    // Disembunyikan owner
}

enum InquiryStatus {
  PENDING     // Belum dibalas
  RESPONDED   // Sudah dibalas owner
  CLOSED      // Selesai
}

enum InquirySenderRole {
  OWNER
  ADMIN
}

// USER & OWNER

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole
  owner     Owner?
  createdAt DateTime @default(now())
}

model Owner {
  id         String     @id @default(cuid())
  userId     String     @unique
  user       User       @relation(fields: [userId], references: [id])
  name       String
  email      String     @unique
  whatsapp   String?
  avatarUrl  String?

  properties Property[]

  createdAt DateTime @default(now())
}

// PROPERTY

model Property {
  id           String         @id @default(cuid())
  name         String
  type         String
  status       PropertyStatus @default(AVAILABLE)

  province     String
  city         String
  address      String?

  totalRoom    Int
  bedroom      Int
  bathroom     Int

  description  String
  priceMonthly Int
  priceYearly  Int

  thumbnailUrl String?
  popularScore Int @default(0)

  ownerId String
  owner   Owner @relation(fields: [ownerId], references: [id])

  photos    PropertyPhoto[]
  inquiries Inquiry[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PropertyPhoto {
  id         String @id @default(cuid())
  url        String
  order      Int    @default(0)

  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

// INQUIRY

model Inquiry {
  id        String        @id @default(cuid())
  name      String
  email     String
  telephone String
  message   String?

  status InquiryStatus @default(PENDING)

  checkIn     DateTime
  checkOut    DateTime
  guests      Int
  billingType String

  propertyId String
  property   Property @relation(fields: [propertyId], references: [id])

  replies   InquiryReply[]
  createdAt DateTime @default(now())
}

model InquiryReply {
  id        String   @id @default(cuid())
  message   String

  senderRole InquirySenderRole

  inquiryId String
  inquiry   Inquiry @relation(fields: [inquiryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}
